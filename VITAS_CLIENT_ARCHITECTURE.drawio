<mxfile host="app.diagrams.net" agent="Claude Code" version="24.0.0">
  <diagram id="VitasClientArch" name="VITAS Client - Frontend Architecture">
    <mxGraphModel dx="3500" dy="2500" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2600" pageHeight="1800" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title-line" value="" style="line;strokeWidth=3;html=1;fontSize=14;shadow=0;sketch=0;" vertex="1" parent="1">
          <mxGeometry x="60" y="80" width="2400" height="10" as="geometry" />
        </mxCell>
        <mxCell id="title-text" value="VITAS Client - Frontend Architecture (Next.js 14 on Vercel)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=32;fontColor=#000000;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="60" y="30" width="1200" height="50" as="geometry" />
        </mxCell>

        <!-- Vercel Container -->
        <mxCell id="vercel-container" value="Vercel Platform - Edge Network" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;verticalAlign=top;fontSize=18;fontStyle=1;dashed=1;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="60" y="120" width="1200" height="1600" as="geometry" />
        </mxCell>

        <!-- ========== FRONTEND LAYER ========== -->
        <mxCell id="frontend-layer" value="FRONTEND LAYER - Next.js 14 App Router with React 18" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;fontSize=16;fontStyle=1;spacingTop=15;" vertex="1" parent="1">
          <mxGeometry x="100" y="180" width="1120" height="300" as="geometry" />
        </mxCell>

        <mxCell id="doctor-ui" value="Doctor Dashboard&#xa;&#xa;• Audio Recording&#xa;• Patient Management&#xa;• Consultation History&#xa;• SOAP Notes Review" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;spacingTop=10;spacingLeft=10;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="160" y="250" width="260" height="150" as="geometry" />
        </mxCell>

        <mxCell id="medinotas-ui" value="Medinotas View&#xa;&#xa;• Consultation Interface&#xa;• SOAP Reports Display&#xa;• ICD-10 Diagnosis Codes&#xa;• Medical History Timeline" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;spacingTop=10;spacingLeft=10;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="480" y="250" width="260" height="150" as="geometry" />
        </mxCell>

        <mxCell id="voice-recorder" value="Voice Recording&#xa;&#xa;• Deepgram WebSocket&#xa;• Real-time Speech-to-Text&#xa;• Audio Waveform Display&#xa;• Transcript Preview" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;spacingTop=10;spacingLeft=10;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="800" y="250" width="260" height="150" as="geometry" />
        </mxCell>

        <!-- ========== STATE MANAGEMENT LAYER ========== -->
        <mxCell id="context-layer" value="STATE MANAGEMENT - React Context and Custom Hooks" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;fontSize=16;fontStyle=1;spacingTop=15;" vertex="1" parent="1">
          <mxGeometry x="100" y="540" width="1120" height="220" as="geometry" />
        </mxCell>

        <mxCell id="user-context" value="UserContext&#xa;&#xa;• Auth State&#xa;• User Profile&#xa;• JWT Token Management" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=12;spacingTop=10;spacingLeft=10;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="160" y="610" width="240" height="110" as="geometry" />
        </mxCell>

        <mxCell id="notification-context" value="NotificationContext&#xa;&#xa;• Processing Status&#xa;• Toast Messages&#xa;• Error Handling&#xa;• Success Alerts" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=12;spacingTop=10;spacingLeft=10;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="460" y="610" width="240" height="110" as="geometry" />
        </mxCell>

        <mxCell id="polling-hook" value="useProcessingNotifications&#xa;&#xa;• 10-second polling interval&#xa;• 10-minute max duration&#xa;• Auto-stop on completion&#xa;• Webhook status check" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=12;spacingTop=10;spacingLeft=10;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="760" y="610" width="240" height="110" as="geometry" />
        </mxCell>

        <!-- ========== API ROUTES LAYER ========== -->
        <mxCell id="api-routes-layer" value="API ROUTES LAYER - Next.js API Routes (30 Total Endpoints)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;verticalAlign=top;fontSize=16;fontStyle=1;spacingTop=15;" vertex="1" parent="1">
          <mxGeometry x="100" y="820" width="1120" height="720" as="geometry" />
        </mxCell>

        <mxCell id="auth-routes" value="Authentication API&#xa;&#xa;• POST /api/auth/signin&#xa;• POST /api/auth/signup&#xa;• GET /api/auth/profile&#xa;• POST /api/auth/logout" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;fontColor=#333333;spacingTop=10;spacingLeft=10;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="140" y="890" width="240" height="120" as="geometry" />
        </mxCell>

        <mxCell id="audio-routes" value="Audio Processing API&#xa;&#xa;• GET /api/audio-to-s3-presigned-url&#xa;• POST /api/upload-audio&#xa;• GET /api/audio-status" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;fontColor=#333333;spacingTop=10;spacingLeft=10;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="420" y="890" width="240" height="120" as="geometry" />
        </mxCell>

        <mxCell id="webhook-route" value="Webhooks API&#xa;&#xa;• POST /api/processing-webhook&#xa;• GET /api/processing-webhook&#xa;• GET /api/webhook-status" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;fontColor=#333333;spacingTop=10;spacingLeft=10;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="700" y="890" width="240" height="120" as="geometry" />
        </mxCell>

        <mxCell id="patient-routes" value="Patient Management API&#xa;&#xa;• GET /api/patients&#xa;• POST /api/patients&#xa;• PATCH /api/patients/:id&#xa;• DELETE /api/patients/:id" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;fontColor=#333333;spacingTop=10;spacingLeft=10;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="980" y="890" width="240" height="120" as="geometry" />
        </mxCell>

        <mxCell id="appointment-routes" value="Appointments API&#xa;&#xa;• GET /api/appointments&#xa;• POST /api/appointments&#xa;• PATCH /api/appointments/:id&#xa;• DELETE /api/appointments/:id" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;fontColor=#333333;spacingTop=10;spacingLeft=10;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="140" y="1060" width="240" height="120" as="geometry" />
        </mxCell>

        <mxCell id="soap-routes" value="Medical Records API&#xa;&#xa;• GET /api/soap-report&#xa;• GET /api/icd-diagnosis&#xa;• PATCH /api/soap-report/:id&#xa;• POST /api/regenerate-soap" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;fontColor=#333333;spacingTop=10;spacingLeft=10;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="420" y="1060" width="240" height="120" as="geometry" />
        </mxCell>

        <mxCell id="transcription-routes" value="Transcription API&#xa;&#xa;• GET /api/transcription/:id&#xa;• POST /api/transcription&#xa;• PATCH /api/transcription/:id" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;fontColor=#333333;spacingTop=10;spacingLeft=10;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="700" y="1060" width="240" height="120" as="geometry" />
        </mxCell>

        <mxCell id="media-routes" value="Media Management API&#xa;&#xa;• GET /api/profile-picture/:id&#xa;• POST /api/upload-picture&#xa;• DELETE /api/picture/:id&#xa;• GET /api/media-presigned-url" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;fontColor=#333333;spacingTop=10;spacingLeft=10;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="980" y="1060" width="240" height="120" as="geometry" />
        </mxCell>

        <mxCell id="deepgram-route" value="Deepgram Proxy API&#xa;&#xa;• POST /api/deepgram&#xa;• WebSocket /api/deepgram/ws&#xa;• Real-time Speech-to-Text" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;fontColor=#333333;spacingTop=10;spacingLeft=10;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="140" y="1230" width="240" height="120" as="geometry" />
        </mxCell>

        <mxCell id="rate-limit" value="Rate Limiting Middleware&#xa;&#xa;• Upstash Redis backend&#xa;• IP-based limiting&#xa;• 100 requests/15min&#xa;• JWT validation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;fontColor=#333333;spacingTop=10;spacingLeft=10;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="420" y="1230" width="240" height="120" as="geometry" />
        </mxCell>

        <mxCell id="utils-note" value="API Route Features&#xa;&#xa;• 30 total API endpoints&#xa;• JWT token validation on all protected routes&#xa;• Zod schema validation for request bodies&#xa;• Centralized error handling middleware&#xa;• TypeScript type safety&#xa;• Request/Response logging&#xa;• CORS configuration for API Gateway" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;spacingTop=10;spacingLeft=12;" vertex="1" parent="1">
          <mxGeometry x="700" y="1230" width="520" height="180" as="geometry" />
        </mxCell>

        <mxCell id="polling-note" value="Polling Mechanism Details&#xa;&#xa;• Interval: Every 10 seconds&#xa;• Maximum duration: 10 minutes&#xa;• Total requests: 60 max&#xa;• Checks webhook status endpoint&#xa;• Auto-stops on completion&#xa;• Toast notification on updates" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;spacingTop=10;spacingLeft=12;" vertex="1" parent="1">
          <mxGeometry x="140" y="1400" width="520" height="120" as="geometry" />
        </mxCell>

        <mxCell id="upload-note" value="Upload Paths to S3&#xa;&#xa;1. Audio upload → S3 audios/ folder → Triggers Standard Workflow&#xa;2. Transcript upload → S3 transcripts/ folder → Triggers Express Workflow&#xa;3. Both paths use presigned URLs for direct upload&#xa;4. Frontend receives webhook POST when processing completes" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;spacingTop=10;spacingLeft=12;" vertex="1" parent="1">
          <mxGeometry x="700" y="1400" width="520" height="120" as="geometry" />
        </mxCell>

        <!-- ========== AWS INFRASTRUCTURE ========== -->
        <mxCell id="aws-layer" value="AWS INFRASTRUCTURE - Cloud Services" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;fontSize=18;fontStyle=1;spacingTop=15;" vertex="1" parent="1">
          <mxGeometry x="1340" y="120" width="1100" height="1000" as="geometry" />
        </mxCell>

        <mxCell id="auth-gateway" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;fillColor=#8C4FFF;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=1;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.api_gateway;" vertex="1" parent="1">
          <mxGeometry x="1420" y="220" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="auth-gateway-label" value="API Gateway&#xa;&#xa;Auth API&#xa;REST Endpoint" style="text;html=1;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="1380" y="310" width="160" height="80" as="geometry" />
        </mxCell>

        <mxCell id="auth-lambda" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;gradientColor=#F78E04;gradientDirection=north;fillColor=#D05C17;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=1;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.lambda;" vertex="1" parent="1">
          <mxGeometry x="1420" y="480" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="auth-lambda-label" value="Auth Lambda&#xa;&#xa;JWT Generation&#xa;User Validation&#xa;256MB / 1min" style="text;html=1;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="1380" y="570" width="160" height="100" as="geometry" />
        </mxCell>

        <mxCell id="dynamodb-auth" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;fillColor=#C925D1;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=1;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.dynamodb;" vertex="1" parent="1">
          <mxGeometry x="1420" y="760" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="dynamodb-auth-label" value="DynamoDB Tables&#xa;&#xa;Doctors Table V2&#xa;Patients Table V2&#xa;Appointments V2" style="text;html=1;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="1380" y="850" width="160" height="100" as="geometry" />
        </mxCell>

        <mxCell id="s3-audio" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;fillColor=#7AA116;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=1;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.s3;" vertex="1" parent="1">
          <mxGeometry x="1700" y="220" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="s3-audio-label" value="S3 Media Bucket&#xa;&#xa;Audio Files&#xa;Transcripts&#xa;Presigned URLs" style="text;html=1;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="1660" y="310" width="160" height="100" as="geometry" />
        </mxCell>

        <mxCell id="s3-results" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;fillColor=#7AA116;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=1;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.s3;" vertex="1" parent="1">
          <mxGeometry x="1700" y="480" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="s3-results-label" value="S3 Results Bucket&#xa;&#xa;SOAP Reports&#xa;ICD Diagnosis&#xa;Object Keys in DB" style="text;html=1;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="1660" y="570" width="160" height="100" as="geometry" />
        </mxCell>

        <mxCell id="cloudfront" value="" style="sketch=0;points=[[0,0,0],[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0,0],[0,1,0],[0.25,1,0],[0.5,1,0],[0.75,1,0],[1,1,0],[0,0.25,0],[0,0.5,0],[0,0.75,0],[1,0.25,0],[1,0.5,0],[1,0.75,0]];outlineConnect=0;fontColor=#232F3E;fillColor=#8C4FFF;strokeColor=#ffffff;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;html=1;fontSize=12;fontStyle=1;aspect=fixed;shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.cloudfront;" vertex="1" parent="1">
          <mxGeometry x="1980" y="220" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="cloudfront-label" value="CloudFront CDN&#xa;&#xa;Profile Pictures&#xa;Static Assets&#xa;Edge Caching" style="text;html=1;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="1940" y="310" width="160" height="100" as="geometry" />
        </mxCell>

        <mxCell id="processing-stack" value="Processing Stack Reference&#xa;&#xa;Step Functions Workflows&#xa;• Standard: Transcription&#xa;• Express: SOAP + ICD Analysis&#xa;&#xa;Lambda Functions (7)&#xa;Dead Letter Queues (3)&#xa;&#xa;See VITAS_PROCESSING_STACK_ARCHITECTURE" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;dashed=1;strokeWidth=2;spacingTop=12;spacingLeft=12;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="1700" y="760" width="380" height="220" as="geometry" />
        </mxCell>

        <!-- ========== EXTERNAL SERVICES ========== -->
        <mxCell id="external-services" value="EXTERNAL SERVICES AND INTEGRATIONS" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;verticalAlign=top;fontSize=18;fontStyle=1;spacingTop=15;" vertex="1" parent="1">
          <mxGeometry x="1340" y="1180" width="1100" height="300" as="geometry" />
        </mxCell>

        <mxCell id="deepgram-service" value="Deepgram&#xa;&#xa;Real-time STT&#xa;WebSocket API" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#6a00ff;fontColor=#ffffff;strokeColor=#3700CC;fontSize=13;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="1440" y="1270" width="140" height="140" as="geometry" />
        </mxCell>

        <mxCell id="upstash-service" value="Upstash Redis&#xa;&#xa;Rate Limiting&#xa;Session Storage" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#76608a;fontColor=#ffffff;strokeColor=#432D57;fontSize=13;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="1660" y="1270" width="140" height="140" as="geometry" />
        </mxCell>

        <mxCell id="mailgun-service" value="Mailgun&#xa;&#xa;Email API&#xa;Notifications" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#e51400;fontColor=#ffffff;strokeColor=#B20000;fontSize=13;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="1880" y="1270" width="140" height="140" as="geometry" />
        </mxCell>

        <mxCell id="vercel-service" value="Vercel&#xa;&#xa;Edge Functions&#xa;Hosting Platform" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#000000;fontColor=#ffffff;strokeColor=#333333;fontSize=13;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="2100" y="1270" width="140" height="140" as="geometry" />
        </mxCell>

        <!-- ========== DATA FLOW PATTERNS ========== -->
        <mxCell id="data-flow-layer" value="DATA FLOW PATTERNS AND INTEGRATION POINTS" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=top;fontSize=18;fontStyle=1;fontColor=#333333;spacingTop=15;" vertex="1" parent="1">
          <mxGeometry x="1340" y="1540" width="1100" height="360" as="geometry" />
        </mxCell>

        <mxCell id="flow1" value="1. Authentication Flow&#xa;&#xa;Client → API Gateway → Auth Lambda → DynamoDB&#xa;→ Returns JWT token for subsequent requests" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;spacingTop=10;spacingLeft=12;" vertex="1" parent="1">
          <mxGeometry x="1380" y="1600" width="480" height="80" as="geometry" />
        </mxCell>

        <mxCell id="flow2" value="2. Audio Upload Flow&#xa;&#xa;Client → S3 presigned URL (audio or transcript)&#xa;→ S3 Event Trigger → Step Functions Workflow" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;spacingTop=10;spacingLeft=12;" vertex="1" parent="1">
          <mxGeometry x="1380" y="1710" width="480" height="80" as="geometry" />
        </mxCell>

        <mxCell id="flow3" value="3. Webhook Flow&#xa;&#xa;Processing Stack → POST /api/processing-webhook&#xa;→ Client receives notification → Polls GET endpoint" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;spacingTop=10;spacingLeft=12;" vertex="1" parent="1">
          <mxGeometry x="1380" y="1820" width="480" height="80" as="geometry" />
        </mxCell>

        <mxCell id="flow4" value="4. Results Fetch Flow&#xa;&#xa;Client → GET /api/soap-report → Fetches S3 object key from DynamoDB&#xa;→ Downloads JSON from S3 using key" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;spacingTop=10;spacingLeft=12;" vertex="1" parent="1">
          <mxGeometry x="1900" y="1600" width="480" height="80" as="geometry" />
        </mxCell>

        <mxCell id="flow5" value="5. Deepgram Real-time Flow&#xa;&#xa;Client WebSocket → Deepgram API → Real-time transcript chunks&#xa;→ Final transcript upload to S3 → Triggers Express Workflow" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=12;spacingTop=10;spacingLeft=12;" vertex="1" parent="1">
          <mxGeometry x="1900" y="1710" width="480" height="80" as="geometry" />
        </mxCell>

        <mxCell id="flow6" value="6. Polling Pattern Details&#xa;&#xa;10-second intervals for maximum 10 minutes (60 requests)&#xa;→ Checks webhook status → Auto-stops on completion or timeout" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fillColor=#f8cecc;strokeColor=#b85450;fontSize=12;spacingTop=10;spacingLeft=12;" vertex="1" parent="1">
          <mxGeometry x="1900" y="1820" width="480" height="80" as="geometry" />
        </mxCell>

        <!-- ========== CONNECTIONS ========== -->
        <mxCell id="conn-auth1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#0066CC;" edge="1" parent="1" source="auth-routes" target="auth-gateway">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1300" y="950" />
              <mxPoint x="1300" y="260" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="conn-auth2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#0066CC;" edge="1" parent="1" source="auth-gateway" target="auth-lambda">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1460" y="420" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="conn-auth3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#0066CC;" edge="1" parent="1" source="auth-lambda" target="dynamodb-auth">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1460" y="700" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="conn-upload" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#00CC00;dashed=1;" edge="1" parent="1" source="audio-routes" target="s3-audio">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1300" y="950" />
              <mxPoint x="1300" y="260" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="conn-s3-trigger" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#FF6600;dashed=1;" edge="1" parent="1" source="s3-audio" target="processing-stack">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1740" y="420" />
              <mxPoint x="1890" y="420" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="conn-webhook-in" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#CC0000;" edge="1" parent="1" source="processing-stack" target="webhook-route">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1640" y="870" />
              <mxPoint x="1640" y="1140" />
              <mxPoint x="820" y="1140" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="conn-results" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#9933FF;dashed=1;" edge="1" parent="1" source="s3-results" target="soap-routes">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1640" y="520" />
              <mxPoint x="1640" y="1160" />
              <mxPoint x="540" y="1160" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="conn-deepgram" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#6600CC;dashed=1;" edge="1" parent="1" source="deepgram-service" target="deepgram-route">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1510" y="1560" />
              <mxPoint x="260" y="1560" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- ========== FLOW MARKERS ========== -->
        <mxCell id="marker1" value="1" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#f8cecc;strokeColor=#b85450;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="1300" y="240" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="marker2" value="2" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#f8cecc;strokeColor=#b85450;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="1640" y="240" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="marker3" value="3" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#f8cecc;strokeColor=#b85450;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="1640" y="840" width="30" height="30" as="geometry" />
        </mxCell>

        <!-- ========== LEGEND ========== -->
        <mxCell id="legend" value="KEY TECHNOLOGIES&#xa;&#xa;Frontend Framework:&#xa;• Next.js 14 with App Router&#xa;• React 18 with TypeScript&#xa;• Material-UI Components&#xa;• Tailwind CSS for styling&#xa;&#xa;State Management:&#xa;• React Context API&#xa;• Custom hooks (useProcessing)&#xa;&#xa;API Layer:&#xa;• Next.js API Routes (30 endpoints)&#xa;• Zod schema validation&#xa;• JWT authentication (jose library)&#xa;&#xa;External Services:&#xa;• Deepgram WebSocket API&#xa;• AWS SDK v3 (S3, DynamoDB)&#xa;• Upstash Redis&#xa;• Mailgun Email API&#xa;&#xa;UI Libraries:&#xa;• Notistack (Toast notifications)&#xa;• React Hook Form&#xa;• Material Icons&#xa;&#xa;Deployment:&#xa;• Vercel Edge Network&#xa;• Automatic deployments&#xa;• Environment variables" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;fontSize=12;spacingLeft=12;spacingTop=12;" vertex="1" parent="1">
          <mxGeometry x="60" y="1760" width="1200" height="360" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
