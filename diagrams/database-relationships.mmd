
erDiagram
    DOCTORS ||--o{ PATIENTDOCTORS : "treats"
    PATIENTS ||--o{ PATIENTDOCTORS : "treated_by"
    DOCTORS ||--o{ APPOINTMENTS_TABLE : "performs"
    PATIENTS ||--o{ APPOINTMENTS_TABLE : "has"
    APPOINTMENTS_TABLE ||--|| DIAGNOSIS : "includes"
    DOCTORS ||--o{ VITAS_APPOINTMENT : "schedules"
    PATIENTS ||--o{ VITAS_APPOINTMENT : "books"
    DOCTORS ||--|| VITAS_SCHEDULE_CONFIG : "configures"
    PATIENTS ||--o{ VITAS_OTP : "requests"
    PATIENTS ||--o{ WA_SESSIONS : "chats_with"

    DOCTORS {
        string doctor_id PK
        string email UK
        string password
        string full_name
        string speciality
        string id_number
        string phone_number
        string profile_picture_url
        boolean active_for_ai_booking
        string created_at
    }

    PATIENTS {
        string patient_id PK
        string phone_number
        string patient_name
        string patient_email
        number patient_age
        string patient_dni
        string status
        boolean chatbot_access
        string last_login
        string created_at
    }

    PATIENTDOCTORS {
        string doctor_id PK
        string patient_id
        string relationship_type
        string created_at
        string notes
    }

    APPOINTMENTS_TABLE {
        string patient_id PK
        string appointment_id
        string doctor_id
        string appointment_date
        string appointment_time
        string status
        boolean paid
        string payment_id
        string audio_s3_key
        string transcription_text
        string soap_subjective
        string soap_objective
        string soap_assessment
        string soap_plan
        string created_at
    }

    DIAGNOSIS {
        string appointment_id PK
        string patient_id
        string doctor_id
        json diagnoses
        string diagnosis_service
        string created_at
    }

    VITAS_APPOINTMENT {
        string doctor_id PK
        string appt
        string appointment_id
        string patient_id
        string appointment_date
        string appointment_time
        string status
        boolean paid
        number payment_amount
        string payment_currency
        string reason
        string created_via
        string created_at
        number ttl
    }

    VITAS_SCHEDULE_CONFIG {
        string doctor_id PK
        string config
        json monday
        json tuesday
        json wednesday
        json thursday
        json friday
        json saturday
        json sunday
        string timezone
        string updated_at
    }

    VITAS_OTP {
        string phoneNumber PK
        string otpCode
        number expiresAt
        string context
        number attempts
        string createdAt
    }

    WA_SESSIONS {
        string session_id PK
        string threadId
        string jwt
        string patientId
        number expiresAt
        number absoluteExpiry
        number lastActiveAt
    }

